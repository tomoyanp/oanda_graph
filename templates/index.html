<!DOCTYPE html>
<meta charset="utf-8">
<style>

    body {
        font: 10px sans-serif;
    }

    text {
        fill: #000;
    }

    button {
        position: absolute;
        right: 20px;
        top: 440px;
        display: none;
    }

    path.candle {
        stroke: #000000;
    }

    path.candle.body {
        stroke-width: 0;
    }

    path.candle.up {
        fill: #00AA00;
        stroke: #00AA00;
    }

    path.candle.down {
        fill: #FF0000;
        stroke: #FF0000;
    }

</style>
<body>
<button>Update</button>
<script src="static/js/d3.min.js"></script>
<script src="static/js/techan.min.js"></script>
<script>
// set the dimensions and margins of the graph
var margin = {top: 20, right: 20, bottom: 30, left: 50},
        width = 960 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

// parse the date / time
var parseDate = d3.timeParse("%Y-%m-%d");

// set the ranges
var x = techan.scale.financetime()
        .range([0, width]);

var y = d3.scaleLinear()
        .range([300, 0]);

var yVolume = d3.scaleLinear()
        .range([height, 300]);

// define the candlestick
var candlestick = techan.plot.candlestick()
        .xScale(x)
        .yScale(y);

// define the sma
var sma = techan.plot.sma()
        .xScale(x)
        .yScale(y);

// define the volume
var volume = techan.plot.volume()
        .xScale(x)
        .yScale(yVolume);

// append the svg obgect to the body of the page
// appends a 'group' element to 'svg'
// moves the 'group' element to the top left margin
var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

//// Get the data
//d3.json('get_data', function(error, data) {
//    console.log(data);
//    var cAccessor = candlestick.accessor();
//    var vAccessor = volume.accessor();
//
//    // format the data & sort by date
//    data = data.slice(0, 140).map(function(d) {
//        return {
//            date: parseDate(d.Date),
//            open: +d.Open,
//            high: +d.High,
//            low: +d.Low,
//            close: +d.Close,
//            volume: +d.Volume
//        };
//    }).sort(function(a, b) { return d3.ascending(cAccessor.d(a), cAccessor.d(b)); });
//
//    // Scale the range of the data
//    x.domain(data.map(cAccessor.d));
//    y.domain(techan.scale.plot.ohlc(data, cAccessor).domain());
//    yVolume.domain(techan.scale.plot.volume(data, vAccessor.v).domain());
//
//    // Add the volume
//    svg.append("g")
//            .attr("class", "volume")
//            .data([data])
//            .call(volume);
//
//    // Add the candlestick
//    svg.append("g")
//            .attr("class", "candlestick")
//            .data([data])
//            .call(candlestick);
//
//   // Add the sma25
//   svg.append("g")
//            .attr("class", "sma ma25")
//            .datum(techan.indicator.sma().period(25)(data))
//            .call(sma);
//
//    // Add the X Axis
//    svg.append("g")
//            .attr("transform", "translate(0," + height + ")")
//            .call(d3.axisBottom(x));
//
//    // Add the Y Axis
//    svg.append("g")
//            .call(d3.axisLeft(y));
//
//   // Add the Volume-Y Axis
//   svg.append("g")
//            .call(d3.axisLeft(yVolume)
//               .ticks(3)
//               .tickFormat(d3.format(",.3s")));
//
//});


data = [
    {"Date": "9-Jun-14"  ,"Open": "62.40", "High": "63.34","Low": "61.79", "Close": "62.88", "Volume": "37617413"},
    {"Date": "6-Jun-14"  ,"Open": "63.37", "High": "63.48","Low": "62.15", "Close": "62.50", "Volume": "42442096"},
    {"Date": "5-Jun-14"  ,"Open": "63.66", "High": "64.36","Low": "62.82", "Close": "63.19", "Volume": "47352368"},
    {"Date": "4-Jun-14"  ,"Open": "62.45", "High": "63.59","Low": "62.07", "Close": "63.34", "Volume": "36513991"},
    {"Date": "3-Jun-14"  ,"Open": "62.62", "High": "63.42","Low": "62.32", "Close": "62.87", "Volume": "32216707"},
    {"Date": "2-Jun-14"  ,"Open": "63.23", "High": "63.59","Low": "62.05", "Close": "63.08", "Volume": "35995537"},
    {"Date": "30-May-14" ,"Open": "63.95", "High": "64.17","Low": "62.56", "Close": "63.30", "Volume": "45283577"},
    {"Date": "29-May-14" ,"Open": "63.84", "High": "64.30","Low": "63.51", "Close": "63.83", "Volume": "42699670"},
    {"Date": "28-May-14" ,"Open": "63.39", "High": "64.14","Low": "62.62", "Close": "63.51", "Volume": "47795088"}
]

console.log(data);
var cAccessor = candlestick.accessor();
var vAccessor = volume.accessor();

// format the data & sort by date
data = data.slice(0, 140).map(function(d) {
    return {
        date: parseDate(d.Date),
        open: +d.Open,
        high: +d.High,
        low: +d.Low,
        close: +d.Close,
        volume: +d.Volume
    };
}).sort(function(a, b) { return d3.ascending(cAccessor.d(a), cAccessor.d(b)); });

// Scale the range of the data
x.domain(data.map(cAccessor.d));
y.domain(techan.scale.plot.ohlc(data, cAccessor).domain());
yVolume.domain(techan.scale.plot.volume(data, vAccessor.v).domain());

// Add the volume
svg.append("g")
        .attr("class", "volume")
        .data([data])
        .call(volume);

// Add the candlestick
svg.append("g")
         .attr("class", "candlestick")
         .data([data])
         .call(candlestick);

// Add the sma25
svg.append("g")
         .attr("class", "sma ma25")
         .datum(techan.indicator.sma().period(25)(data))
         .call(sma);

 // Add the X Axis
 svg.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(x));

 // Add the Y Axis
 svg.append("g")
         .call(d3.axisLeft(y));

// Add the Volume-Y Axis
svg.append("g")
         .call(d3.axisLeft(yVolume)
            .ticks(3)
            .tickFormat(d3.format(",.3s")));




</script>
